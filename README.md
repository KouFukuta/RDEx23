# RDEx23
 ## 情報表現領域_展示作品

### 進捗2024/01/11
<dl>
   <dt>スピーカーの配置、実際に鳴らしてみた</dt>
      <dd>サラウンドのシステムは問題なし、距離感も今の配置で問題なく感じる。しかし、自分がどこに音を動かしているのかがわかりづらく感じる。ずっと音が鳴っているわけではないので、わかりづらい気がする。</dd>
      <dd>自分の録った音も使えるといいが、パンニング操作できるトラックは一つだけなので、音の操作の部分がわかりやすくなることは難しい気がしてきた。</dd>

   <dt>M5Stack側のボディの再設計</dt>
      <dd>アクリルをはめ込めるようにした。一枚表面をやすり掛けして、すりガラスのようにしてみた。光り方は面白くなるが、ディスプレイの表示が見えなくなるので、どちらにしようか考え中。もっときれいにやすり掛けした表面を仕上げるのもやらないといけない。</dd>

   <dt>ESP側の配置</dt>
      <dd>ESP32をスピーカースタンドのどこかに固定するようにしたいので、簡易的な入れ物をCADで設計してみた。</dd>
      <dd>4階のスペースで試しているため、音をあまり大きく出せなかったからか、マイクの感度がそこまでよくないのか、うまく音を拾ってくれないことがある。マイクモジュールを置く位置とスピーカーから出す音の大きさのバランスも考える必要がありそう。</dd>
      <dd>電源はコンセントからUSBで取ることにする。</dd>

</dl>

### 進捗2023/12/14
<dl>
	<dt>デバイスのボディの制作</dt>
   	<dd>試作を3Dプリンターで製作。ケーブルは通るが、端子部分がギリギリ通らなかったり、NeoPixelの背面が少し合わなくて上部分だけ作り直そうと思う。</dd>
      <dd>それ以外はヤスリ掛けをしたらなんとかなったので、そのまま塗装して使おうと思う。</dd>
</dl>

### 進捗2023/12/07
<dl>
   <dt>M5Stackのディスプレイ</dt>
   <dd>どっちに端末が傾いているか、どっちにパンニング操作をしているかを可視化させるためにビジュアルを作成した。どの子機が反応しているのかもわかるようにした。</dd>

   <dt>Fusion360でのボディの設計</dt>
   <dd>M5StackのビジュアルとNeoPixelをどちらも見えるようなボディを設計中。仮の段階なのでまだ変更or作り直しもする予定。</dd>
</dl>

### 進捗2023/11/30
<dl>
   <dt>OSC通信が終わった後のデータの問題</dt>
   <dd>rssi[] = {}ではなく、rssi[2] = {}と定義したら、２台では一応動くようにはなった。しかし、4台に増やすとどうしてもどこかがおかしくなる。</dd>
   <dd>比較するところでfor文を使うとおかしくなるのかと思い、if文だけでやっても上手くいかなかった。要修正</dd>
   <dd>データ送信側は完成で良いと思う。あとはどういう風にスピーカー側につけるかを考えればOK</dd>
   
   <dt>他にやりたいこと</dt>
   <dd>M5Stackをそのまま持たせるわけにはいかないので、3Dプリンターか何かでデバイスのボディを作りたい。</dd>
   <dd>実際と同じような環境でテストしてみたい。</dd>
</dl>

### 進捗2023/11/23
<dl>
   <dt>M5とESPの親機、子機を入れ替えての作り替え</dt>
   <dd>M5側を親機、ESP側を子機として作り直しているが、RSSIやピーク値の通信がうまくいっていない。</dd>
   <dd>今のままのプログラムだと通信に成功しても、子機に近づいた後に離れてもRSSIの値が弱くならないので、明暗での調節がうまくいかないかもしれない、もしかしたら仕様を戻すかもしれない</dd>
   
   <dt>M5Stackをジャイロマウスにして音を回してみる??</dt>
   <dd>M5StackをジャイロマウスにしてAuditionのパンニングを動かせるようにした。体験する人が手持ちのデバイスを傾けて音を回せるようにすると面白いかもしれない。</dd>

   <dt>展示企画書の製作</dt>
   <dd>大まかな部分などは書いたつもりだが、スピーカーを置く台や、展示スペースがどのくらい取れるのかを確認したい。</dd>
</dl>

### 進捗2023/11/16
<dl>
   <dt>WiFiMultiに対応させた</dt>
   <dd>Wi-Fiのアクセスポイントを複数登録して、接続が切れた場合に、もう一方への接続のし直しができるようになった。</dd>
   <dd>しかし、再接続に5秒ほどかかるので、もう少し早くできると良いとは思う。</dd>

   <dt>音が鳴ったときだけNeoPixelを光らせるようにした</dt>
   <dd>マイクのデジタル出力を使用して、音が鳴ってデジタル出力が「1」を出力したときにNeoPixelが光るようにした。デジタル出力も可変抵抗で感度調節ができるため、周りの雑音を拾って誤出力をしてしまうことは少ないと思う。</dd>

   <dt>常にRSSIの強いWi-Fiに接続させたい</dt>
   <dd>if文で、現在接続しているWi-FiのRSSIとスキャンした周辺のWi-FiのRSSIを比較して強いほうへつなぐプログラムを書いたが、それを入れるとピーク値とRSSIの通信が止まってしまい、動かなくなってしまう。要修正。</dt>

   <dt>AVアンプのテスト</dt>
   <dd>AVアンプが届いたため、サラウンドのテストをした。Auditionでパンニングを動かしてみて、音が回ったり、一定の方向から出せるのかテストをした。作ったスピーカーもしっかりと接続でき、音を鳴らすことができたため、正常に動作してくれていると思う。</dd>
</dl>


### 進捗2023/11/09  
<dl>
   <dt>RSSI(通信強度)の測定、親機、子機ともにプログラムを作成</dt>
      <dd>BLE通信は少しやり方がわからなかったので、Wi-Fiで測定</dd>
      <dd>参考サイト:https://fabcross.jp/category/make/sorem5/20210512_social_distance_onigokko.html</dd>
      <dd>近くて30付近、3mほど離れるとRSSI:70、5mでもRSSI:80ほどだった</dd>
   
   <dt>MajorPeakを使ってFFTのピークの値を取得させてみた</dt>
      <dd>MajorPeakを使ってピーク値を取得してみたが、たまにピークの値とは全く違う値が取得されるので、見直す必要があるかもしれない。</dd>
      <dd>参考サイト:https://101010.fun/m5stickc-plus-accel.html</dd>

   <dt>FFTとRSSI取得のプログラムをひとつにまとめた</dt>
      <dd>一応どちらの値の取得はできるようになったので、これを改変しつつ、本番用に変えていく予定。</dd>

   <dt>仕様変更版を追加</dt>
      <dd>将来的に複数チャンネルを扱うようになると、手持ちデバイス側にマイクがついているとあまり意味がない気がしたので、仕様変更をしたものを追加</dd>
      <dd>親機にマイク、子機にNeoPixelをつける仕様、親機はマイクで測ったピーク値を子機に送信、子機はRSSIを測り、受信したピーク値と測ったRSSIを使ってNeoPixelの光り方を変えるようにした。NeoPixelの色を変更する部分は調整中。</dd>

   <dt>残りのスピーカーの制作</dt>
      <dd>工房で残りの分のスピーカーのアクリルを切断して、スピーカー作りをした。今は4台できている。2台できたときにステレオ再生を試したが、問題なく再生できた。あと1台組み立てたらとりあえずスピーカーは完成</dd>
</dl>


 ### 進捗2023/11/02
 <dl>
   <dt>M5側に外付けマイク用のプログラムに変更</dt>
      <dd>FFTにも対応させた。参考サイト:https://ambidata.io/samples/m5stack/sound/</dd>
      <dd>いちばん振幅の多い周波数を抜き出して、それの値でNeoPixelの色を変更する予定</dd>
      <dd>拾った音の周波数の値が少しおかしい、1kHzを出すと4kHzぐらいの表記になる</dd>
      <dd>今はFFTのスペクトルを表示してあるが、ここをどうするかも考える必要あり</dd>

   <dt>ESP側とM5側でのBluetooth通信のテスト</dt>
      <dd>参考サイト:https://www.remma.net/?p=367</dd>
      <dd>M5側を送信、ESP側を受信に設定、ペアリングからデータ送受信までは一応できた</dd>
      <dd>このままのプログラムだとM5側の液晶の表示がおかしくなるので要改良</dd>
      <dd>delayをはさむと通信できなくなるかも？</dd>
      <dd>たまに接続した瞬間に接続が切れることあり、用改良</dd>
      <dd>どうやってここからおおまかな距離を測れるようにするかを考える必要あり</dd>

   <dt>追加のスピーカーの素材の注文完了</dt>
      <dd>すべて到着したので、また工房に切りに行く(来週の前半あたり？)</dd>
</dl>


